#VRML_SIM R2023b utf8
# Visualisation of the position of real or simulated mobile robots
# template language: javascript

# made by Thomas Feldmeier 2022, www.servicerobotik-ulm.de

EXTERNPROTO "CrossWithArrow.proto"

PROTO MobileRobotPose [
  field       SFString     baseComponent         "ComponentWebotsMobileRobot"
  field       SFVec3f      translationLocation   0 0 0
  field       SFRotation   rotationLocation      0 0 1 0
  field       SFVec3f      translationOdometry   0 0 0
  field       SFRotation   rotationOdometry      0 0 1 0
  unconnectedField SFFloat velocityForward       0.0
  unconnectedField SFFloat velocityLeft          0.0
  unconnectedField SFFloat velocityRotation      0.0
  unconnectedField SFVec3f covMatrixDiagonal     0 0 0
  hiddenField  SFFloat     transparencyOdometry  0.5
  hiddenField  SFFloat     transparencyRoute     1.0
  hiddenField  MFNode      trailPoints           [ ]
  hiddenField  MFVec3f     route                 [
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0,
    0 0 0, 1 0 0, 0 1 0]
]
{
Solid {
  name IS baseComponent
  children [
    Pose {
      translation IS translationLocation
      rotation IS rotationLocation
    }
    Pose {
      translation 0 0 0.02
      children [
        Pose {
          translation IS translationOdometry
          rotation IS rotationOdometry
          children [
            CrossWithArrow {
              color 1 0 0
              transparency IS transparencyOdometry
            }
          ]
        }
      ]
    }
    Pose {
      translation 0 0 0.03
      children [
        Group {
          children IS trailPoints
        }
        Pose {
          translation IS translationLocation
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0 0 1
                roughness 1
                metalness 0
                transparency IS transparencyRoute
              }
              geometry IndexedFaceSet {
                coord Coordinate {
                  point IS route
                }
                coordIndex [
                  0 1 2 -1
                  3 4 5 -1
                  6 7 8 -1
                  9 10 11 -1
                  12 13 14 -1
                  15 16 17 -1
                  18 19 20 -1
                  21 22 23 -1
                  24 25 26 -1
                  27 28 29 -1
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}
}
